<?php require(DIR_SYSTEM."lightning/config.php");$Wi_="1.21";$Wja=false;if(!empty($_GET["op"]))$Wja=$_GET["op"];$Wjb="blue";$Wjc=DIR_LOGS.'ba';$Weh='';$Wjd=false;define('Wb',DIR_CACHE."lightning/".'c');define('Wbo',DIR_CACHE."lightning/cached_pages.log");if(isset($_POST['lc']))Wci();if(file_exists($Wjc)){$Weh=file_get_contents($Wjc);if($Weh=='bk'){$Wjb="grey";$Weh='';}else{$Wjb="red";if(substr($Weh,-1)=='#'){$Weh=substr($Weh,0,-1);$Wjd=true;}}}$Wje=Wb.'t';$Wjf=false;if(file_exists($Wje))$Wjf=file_get_contents($Wje);if($light_cache_pages and!file_exists($Wjc)and!file_exists(DIR_CACHE."lightning/alpha"))$Wjf=1;if($Wja=="disable"){file_put_contents($Wjc,'bk');Wcj();Wap(true);if(file_exists($Wje))unlink($Wje);exit;}if($Wja=="clear_caches"){require_once DIR_SYSTEM."lightning/beta.php";$Wy=DIR_CACHE."lightning/alpha";Wu();$Wy=DIR_CACHE."lightning/beta";Wu();$Wy=DIR_CACHE."lightning/gamma";Wu();$Wy=DIR_CACHE."lightning/tetha";Wu();foreach(glob(DIR_CACHE."lightning/".'c'."*")as$Wha)if(!is_dir($Wha))unlink($Wha);foreach(glob(DIR_CACHE."*")as$Wha)if(!is_dir($Wha))unlink($Wha);$Wjg=DIR_LOGS."lightning.log";if(file_exists($Wjg))unlink($Wjg);$Wjg=DIR_LOGS."lightning_optimize.log";if(file_exists($Wjg))unlink($Wjg);if(file_exists(Wbo))unlink(Wbo);exit;}function Wcj(){if(file_exists(Wb))unlink(Wb);}function Wck($Wjh){$W_=DIR_CACHE."lightning/$Wjh/meters";if(file_exists($W_))return explode(',',file_get_contents($W_));return array(0,0);}function Wq($War){$Was=0;while($War>=1024){$War/=1024;$Was++;}if($War<10)$War=round($War,2);else$War=round($War);$Wat=array("bytes","Kb","Mb","Gb","Tb");$Wau=$War." ".$Wat[$Was];return$Wau;}function num($Wer){if($Wer<1)$Wer=round($Wer,3);elseif($Wer<2)$Wer=round($Wer,2);elseif($Wer<6)$Wer=round($Wer,1);else$Wer=round($Wer);return($Wer);}$Wep=Wck("beta");$Wji=Wck("alpha");$Wjj=Wck("gamma");$Wjk=Wck("tetha");$Wjl=0;if($Wji[0])$Wjl=($Wji[1]+$Wjj[1])/$Wji[0];$Wjm=@disk_free_space(DIR_CACHE);if($Wjm)$Wjm=Wq($Wjm);if(file_exists(DIR_CACHE."lightning/".'be'))$Wiz=unserialize(file_get_contents(DIR_CACHE."lightning/".'be'));else{$Wiz=array();}$Wjn=0;if(!empty($Wiz['bj']))$Wjn=$Wiz['bj'];$Wjo="http://lightning.devs.mx/buy.php?host=".str_replace("https://","",str_replace("http://","",HTTP_SERVER));$Wjp=false;if(file_exists(Wb)){$Wdp=unserialize(file_get_contents(Wb));$Wjp=$Wdp['bl'];if(substr($Wjp,0,1)=="<")$Wjd=true;$Wjp=str_replace("[license]"," ",$Wjp);if(substr($Wjp,-1)==" ")$Wjp.="<a class='lightning_links' target='blank' href='".$Wjo."'>[buy license]</a>";}function Wci(){if(!file_exists(DIR_CACHE."lightning")){@mkdir(DIR_CACHE."lightning",0777,true);@chmod(DIR_CACHE."lightning",0777);}file_put_contents(Wb,stripslashes($_POST['lc']));$Wjq=unserialize(stripslashes($_POST['bd']));foreach($Wjq as&$Wjr)$Wjr=str_replace("xy".'aq'."xy","SELECT",$Wjr);file_put_contents(Wb.'bd',serialize($Wjq));echo'OK';exit;}function ssl($Wap){if(empty($_SERVER["HTTPS"]))return$Wap;return str_replace("http:","https:",$Wap);}if(empty($_SERVER["HTTP_X_REQUESTED_WITH"])){?><head><title>OpenCart Lightning</title><base href="<?php echo ssl(HTTP_SERVER).'admin/' ?>"/><script src="<?php echo ssl('http:') ?>//code.jquery.com/jquery-2.1.1.min.js"type="text/javascript"></script><link rel="stylesheet"type="text/css"href="<?php echo ssl('http:') ?>//lightning.devs.mx/service/css/tetha.css"/></head><body><div id="lightning"><?php }?><div class="top"<?php if(!$light_small_widget){?>id="lightning_container"<?php }?>><img src="<?php echo ssl('http:') ?>//lightning.devs.mx/service/image/light_<?php echo $Wjb ?>.png"height="28"width="28"style="position:absolute; z-index: 100; margin-left: -20px; margin-top: -5px"><?php if(!$light_small_widget){?><div class="lightning_bar"><?php if($Wjf!==false){echo"Pre-generating <strong><span id='li_percent'>".$Wjf."</span>%</strong>";?><?php }elseif(num($Wjn)){?><strong><?php echo num($Wjn)." "?>sec</strong> <span style="color:#DDD">latency</span><?php }if($Wjm){?><div style="float: right"><strong><?php echo$Wjm ?></strong> <span style="color:#DDD">free</span></div><?php }?></div><div id="li_bar"style="position: relative;height: 34px;<?php $Wjs=0;if($Wjn)$Wjs=190/5*$Wjn+10;if($Wjf)$Wjs=$Wjf*2;if($Wjs>200)$Wjs=200;echo"width: $Wjs"."px; background-color: ";if($Wjf)echo"#239b25";elseif($Wjn<2)echo"#3065b5";elseif($Wjn<4)echo"#82701b";else echo"#9e3c3c";?>"></div><?php }?><div id="lightning_menu"><div style="text-align: center; margin-top: 10px"><img src="<?php echo ssl('http:') ?>//lightning.devs.mx/service/image/light_<?php echo $Wjb ?>.png"style=""><div style="font-size:17px; margin-top:5px">OpenCart&nbsp;<strong>Lightning</strong></div><div class="lightning_version">v.<?php echo$Wi_ ?></div><div class="lightning_license"><?php echo$Wjp ?></div><?php if($Weh){?><strong>Lightning disabled:</strong><div style="color:#9a1b1b; font-size: 14px; margin-bottom: 20px;"><?php echo$Weh ?></div><?php }?></div><?php if($Wjd){?><a target="_blank"href="<?php echo $Wjo ?>"class="lightning_button lightning_active">Purchase License</a><?php }?><?php if(!file_exists($Wjc)){?><div class="lightning_button"onclick="$.ajax('../index.php?li_op=t&op=disable&rd='+Date.now()).done(function(){Ul();});">Disable</div><?php }else{?><div class="lightning_button"onclick="if($(this).hasClass('lightning_active'))return;$(this).html('Enabling ... <img class=\'lightning_work\' src=\'<?php echo ssl('http:')?>//lightning.devs.mx/service/image/loading.gif\'>');$(this).addClass('lightning_active');lu=false;$.get('../index.php?li_op=gens&cd='+Date.now(),function(data){lu=true;Ul();if(data['gen']==true)li_gen();},'json');"><strong>Enable</strong></div><?php }?><div class="lightning_button"id="light_clearcaches"onclick="if($(this).hasClass('lightning_active'))return;$(this).html('Clearing Caches ... <img class=\'lightning_work\' src=\'<?php echo ssl('http:')?>//lightning.devs.mx/service/image/loading.gif\'>');$(this).addClass('lightning_active');lu=false;$.ajax('../index.php?li_op=t&op=clear_caches&rd='+Date.now()).done(function(){<?php if(!file_exists($Wjc)){?>$.ajax('../index.php?li_op=gens&cd='+Date.now()).done(function(){lu=true;Ul();li_gen();});<?php }else{?>lu=true;Ul();<?php }?>});">Clear Caches</div><div class="lightning_h3">Usage Statistics</div><?php if($Wji[0]){?><div class="lstat">Page Cache:<?php echo" "?><span id="li_psize"><?php echo Wq($Wji[1])."</span> <span class='lightning_grey'>(<span id='li_pages'>$Wji[0]</span> pages)"?></span></div><?php }?><?php if($Wjk[0]){?><div class="lstat">AJAX Cache:<span> <?php echo Wq($Wjk[1])."</span> <span class='lightning_grey'>($Wjk[0] requests)"?></span></div><?php }?><?php if($Wep[0]){?><div class="lstat">DB Cache:<span> <?php echo Wq($Wep[1])."</span> <span class='lightning_grey'>($Wep[0] queries)"?></span></div><?php }?><?php if($Wiz&&@$Wiz['bh']>1){?><div class="lstat">Average page time without Lightning:<span style="color:#9a1b1b"> <?php echo num($Wiz['bi']/$Wiz['bh'])." sec</span> <span class='lightning_grey'>(based on ".$Wiz['bh']." pages)"?></span></div><?php }?><?php if($Wiz&&@$Wiz['bf']>1){?><div class="lstat">Average page time with Lightning:<span style="color:green"> <?php echo num($Wiz['bg']/$Wiz['bf'])." sec </span> <span class='lightning_grey'>(based on ".$Wiz['bf']." pages)"?></span></div><?php }?><?php if($Wiz&&@$Wiz['bf']>1 and @$Wiz['bh']>1){$Wjt=@round(($Wiz['bi']/$Wiz['bh'])/($Wiz['bg']/$Wiz['bf']));if($Wjt>1){?><div class="lstat">Calculated speed up:&nbsp;<span style="color:green">x&nbsp;<?php echo$Wjt." times</span>"?></div><?php }}?><a class="lightning_links"target="_blank"href="http://speed.devs.mx/index.html?url=<?php echo HTTP_SERVER ?>">Check Shop Speed</a><br/><a class="lightning_links"target="_blank"href="http://lightning.devs.mx/support/"style="float:left">Support</a><a class="lightning_links"target="_blank"href="http://lightning.devs.mx/uninstall/"style="float:right">Uninstall</a></div></div><?php if(empty($_SERVER["HTTP_X_REQUESTED_WITH"])){?></div><script type="text/javascript">var lu=true;var lv=true;var lt=false;function Ul(){if(!lu)return;if(!lv)return;lu=false;$.get('../index.php?li_op=t&rd='+Date.now(),false,function(data){$('#lightning').html(data);},"html").done(function(){lu=true;});}$(document).ready(function(){setInterval('Ul()',5000);Ul();});$(window).focus(function(){lv=true;Ul();});$(window).blur(function(){lv=false;});var li_genx=false;function li_gen(){li_genx=true;$.get('../index.php?li_op=gen&cd='+Date.now(),false,function(data){if(!data){$('#li_percent').html(100);$('#li_bar').css('width','200px');li_genx=false;return;}$('#li_bar').css('width',data['width']);$('#li_percent').html(data['percent']);$('#li_pages').html(data['pages']);$('#li_psize').html(data['psize']);li_gen();},'json');}</script><?php }?><?php if($light_cache_pages and(!file_exists($Wjc)and!file_exists(DIR_CACHE."lightning/alpha"))||$Wjf!==false){?><script type="text/javascript">if(!li_genx){$.ajax('../index.php?li_op=gens&cd='+Date.now()).done(function(){li_gen();});}</script><?php }?><?php if(empty($_SERVER["HTTP_X_REQUESTED_WITH"])){?></body><?php }exit;?>