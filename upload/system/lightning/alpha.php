<?php require_once DIR_SYSTEM."lightning/config.php";$Wa=time()-$light_pagetime*60;$Wb=time()-$light_max_pagetime*60;if(!empty($_COOKIE['a']))return;$Wc=500*1024*1024;if(function_exists("apache_setenv"))apache_setenv("no-gzip","1");define('Wb',DIR_CACHE."lightning/".'c');define('Wbo',DIR_CACHE."lightning/cached_pages.log");if(!empty($_GET["li_op"])){if(isset($_SERVER["HTTPS"])&&(($_SERVER["HTTPS"]=="on")||($_SERVER["HTTPS"]=="1"))&&substr(HTTP_SERVER,0,5)!="https"){$_SERVER["HTTPS"]=false;$_SERVER["SERVER_PORT"]=80;}}if(!file_exists(Wb)or filemtime(Wb)<time()-60*60*12){require_once"beta.php";Waz(true);if(!Wa()){if(!empty($_GET["li_op"])){$Wd["gen"]=false;$We=json_encode($Wd);echo($We);exit;}return;}}else Wa();if(!$light_cache_pages){if(!empty($_GET["li_op"])){if($_GET["li_op"]=="gen"and(!$light_cache_pages or!$light_pregenerate))exit;$Wd["gen"]=false;$We=json_encode($Wd);echo($We);exit;}return;}$Wf=false;if(!empty($_COOKIE["PHPSESSID"])){if(!session_id()){ini_set("session.use_only_cookies","On");ini_set("session.use_trans_sid","Off");ini_set("session.cookie_httponly","On");session_set_cookie_params(365*24*60*60,'/');session_start();}$Wg=session_id();$Wh=!empty($_SESSION["user_id"]);if(empty($_SESSION["customer_id"]))$Wi=0;else$Wi=$_SESSION["customer_id"];$Wj=$_SESSION;}else{$Wg=0;$Wh=0;$Wi=0;$Wj=array();}$Wk=!empty($_SERVER["HTTP_X_REQUESTED_WITH"]);$Wl=Wb();$Wm=Wc();$Wn=$Wl;if($Wo['b']and$Wi)$Wn.='CU';$Wp=false;if(!empty($_GET["li_op"])){$Wk=false;$Wp=$_GET["li_op"];if(isset($_GET["cd"])){$Wq=$_GET["cd"];if($Wq>10000000)$Wq=0;}if(isset($_GET["md"]))$Wr=$_GET["md"];}if(empty($light_ignore_url_params))$light_ignore_url_params="sdsdfsdfe ";if(!empty($_GET["li_op"]))$light_ignore_url_params.=" li_op rd cd md";$_SERVER["REQUEST_URI"]=str_replace('?','&',$_SERVER["REQUEST_URI"]);foreach(explode(' ',$light_ignore_url_params)as$Ws)if(isset($_GET[$Ws])){$_SERVER["REQUEST_URI"]=str_replace('&'.$Ws.'='.$_GET[$Ws],'',$_SERVER["REQUEST_URI"]);unset($_GET[$Ws]);}if(substr($_SERVER["REQUEST_URI"],-1)=="&")$_SERVER["REQUEST_URI"]=substr($_SERVER["REQUEST_URI"],0,-1);if($Wt=strpos($_SERVER["REQUEST_URI"],'&'))$_SERVER["REQUEST_URI"]=substr($_SERVER["REQUEST_URI"],0,$Wt).'?'.substr($_SERVER["REQUEST_URI"],$Wt+1);if($Wk or!$light_convert_currencies){$Wu=$Wn;$Wn.=$Wm;}if(session_id()and((VERSION<"2.0"&&ini_get("register_globals"))or$Wp))session_write_close();$_SERVER["REQUEST_URI"]=Wd($_SERVER["REQUEST_URI"]);$Wv="http".(($_SERVER["SERVER_PORT"]==443)?"s://":"://").$_SERVER["HTTP_HOST"].Wcw($_SERVER["REQUEST_URI"]);$Ww=$Wn.$Wv;if($Wo['d']and!$Wh)$Ww=$Wn.'e';if($Wp=="gen"){ignore_user_abort(true);$Wx=time();require_once"beta.php";We();return;}if($Wk and!$light_cache_ajax)return;if($_SERVER["REQUEST_METHOD"]==="POST"){if($Wk){if(!empty($_POST))$Ww.=serialize($_POST);}else{$Ww=false;return;}}if($Wk)$Wy=DIR_CACHE."lightning/tetha";else$Wy=DIR_CACHE."lightning/alpha";$We=false;$Wz=md5($Ww);$W_="/".substr($Wz,0,2)."/c".substr($Wz,2);if($Wp=="gens"){if($Wo['d']and!$Wh)exit;ignore_user_abort(true);$Wx=time();require_once"beta.php";Wf();$Wd["gen"]=Wg();$Wd["md"]=array();if(empty($Wr)){if($Wd["gen"]){We();return;}Wh();}unset($Waa);unset($_GET["rd"]);return;}if(!empty($_SESSION["customer_id"])){if(!Wa($Wl))return;if(!$Wf['p'])return;}if(!file_exists($Wy.$W_)){Wi();return;}$Wab=0;$Wac=0;$Wab=filemtime($Wy.$W_);if($Wab<$Wb){Wi();return;}$Wad=$Wi||!empty($_SESSION["cart"])||!empty($_SESSION["wishlist"])||!empty($_SESSION["compare"])||($Wm!=$Wo['f']&&$light_convert_currencies);if(!empty($light_track_last_modified)and($Wae or!$Wad)){header("Cache-Control: must-revalidate");$Waf=DIR_CACHE."lightning/delta".$W_;if(file_exists($Waf)){$Waf=unserialize(file_get_contents($Waf));if($Wae)$Wag=$Waf["smd"];else$Wag=$Waf["md"];if(!empty($_SERVER["HTTP_IF_MODIFIED_SINCE"])){$Wah=strtotime(substr($_SERVER["HTTP_IF_MODIFIED_SINCE"],5));if($Wah&&$Wah>=$Wag){header($_SERVER["SERVER_PROTOCOL"]." 304 Not Modified");exit;}}header("Last-Modified: ".gmdate("D, d M Y H:i:s \G\M\T",$Wag));}}if($Wh){$Wai=DIR_CACHE."lightning/gamma".$W_;if(file_exists($Wai))unlink($Wai);}$We=file_get_contents($Wy.$W_);if(!$Wk)if($Wad){if(!Wa($Wl))return;if(!empty($_SESSION["customer_id"])and!$Wf['p'])return;Wk($We);if($Wm!=$Wo['f']&&$light_convert_currencies){$Waj=$Wf['g'][$Wm];Wl('',"//$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]",'name="redirect" value="','"',$Waj);Wm($Wf['h'],$Waj,$We);Wn($Wo['f'],$Wm,$We);}if(!empty($_SESSION['i']))Wm($Wf['j'],$_SESSION['i'],$We);if(!empty($_SESSION["wishlist"]))Wm($Wf['k'],count($_SESSION["wishlist"]),$We);if(!empty($_SESSION["compare"]))Wm($Wf['l'],count($_SESSION["compare"]),$We);if(!empty($_SESSION["customer_id"])){if(empty($_SESSION['m']))$Wak="Customer";else$Wak=$_SESSION['m'];$Wal=str_replace('<Wn>',$Wak,$Wf['o']);Wm($Wf['p'],$Wal,$We);}}if(strpos($Ww,"journal2/assets/css")){header("Content-Type: text/css");}elseif(strpos($Ww,"journal2/assets/js")){header("Content-Type: application/javascript");}else header("Content-Type: text/html; charset=utf-8");if($Wk&&((($Wab-Wj($Ww))<$Wa)or$Wh)){Wo($We,true);require_once"beta.php";$Wam=2;ini_set("display_errors","Off");ini_set("log_errors","Off");Wi();return;}Wo($We);exit;function Wf(){global$db,$Wo,$Wv,$Wi;if(!$Wo['q'])return;$Wan=false;if(!$db){$db=Wcs();$Wan=true;}if(isset($_SERVER["REMOTE_ADDR"])){$Wao=$_SERVER["REMOTE_ADDR"];}else{$Wao='';}$Wap=$Wv;$Waq='';$db->query("DELETE FROM `".DB_PREFIX."customer_online` WHERE (UNIX_TIMESTAMP(`date_added`) + 3600) < UNIX_TIMESTAMP(NOW())");$db->query("REPLACE INTO `".DB_PREFIX."customer_online` SET `ip` = '".$db->escape($Wao)."', `customer_id` = '".(int)$Wi."', `url` = '".$db->escape($Wap)."', `referer` = '".$db->escape($Waq)."', `date_added` = NOW()");if($Wan)$db=false;}function Wp(){global$Wp,$Wj,$Wam;if($Wam==2){$Wam=false;Wbs();}if($Wp!="gen"&&$Wp!="gens"&&!$Wam)return array();if(session_id())session_write_close();return$Wj;}function Wq($War){$Was=0;while($War>=1024){$War/=1024;$Was++;}if($War<10)$War=round($War,2);else$War=round($War);$Wat=array("bytes","Kb","Mb","Gb","Tb");$Wau=$War." ".$Wat[$Was];return$Wau;}function Wd($Wap){if(substr($Wap,-27)=="index.php?route=common/home")$Wap=substr($Wap,0,-27);elseif(substr($Wap,-9)=="index.php")$Wap=substr($Wap,0,-9);$Wap=urldecode($Wap);$Wap=str_replace("&amp;","&",$Wap);$Wav=substr($Wap,-1);if($Wav=="?"||$Wav=="&")$Wap=substr($Wap,0,-1);return$Wap;}function Wcw($Wap){global$light_ignore_url_params;if(!$light_ignore_url_params)return$Wap;$Wap=str_replace('?','&',$Wap);foreach(explode(' ',$light_ignore_url_params)as$Ws)if(isset($_GET[$Ws])){$Wap=str_replace('&'.$Ws.'='.$_GET[$Ws],'',$Wap);}$Wav=substr($Wap,-1);if($Wav=="&")$Wap=substr($Wap,0,-1);$Wt=strpos($Wap,'&');if($Wt)$Wap=substr($Wap,0,$Wt).'?'.substr($Wap,$Wt+1);if(substr($Wap,-27)=="index.php?route=common/home")$Wap=substr($Wap,0,-27);elseif(substr($Wap,-9)=="index.php")$Wap=substr($Wap,0,-9);return$Wap;}function Wh($Waw=false){global$Wd,$Wp,$Waa,$Wy;header("HTTP/1.1 200 OK");;if(!$Wd){if($Waw){if($Wp=="gen"&&!$Waa['id']){$Wy=DIR_CACHE."lightning/alpha";$Wax=Wr();$Way["pages"]=$Wax[0];$Way["psize"]=Wq($Wax[1]);$Way["width"]=round(($Waa['r']-count($Waa['s']))/$Waa['r']*200);$Way["percent"]=round(($Waa['r']-count($Waa['s']))/$Waa['r']*100);$Way["width"].="px";$We=json_encode($Way);echo$We;}else echo"OK";}exit;}if($Waw and!$Waa['id']and!file_exists(Wb.'t'))file_put_contents(Wb.'t','1');if(!$Waw and!$Waa['id']and file_exists(Wb.'t'))unlink(Wb.'t');$Wd["gen"]=$Waw;$We=json_encode($Wd);echo($We);exit;}function We(){if(!file_exists(Wb.'u'))Wh();global$Waa,$Wq,$Wy,$Wv,$Wn,$Wa,$Waz;$Waa=unserialize(file_get_contents(Wb.'u'));if($Waa['id']!=$Wq)Wh();$Wy=DIR_CACHE."lightning/alpha";$Waz=$Wv;$Wv=false;foreach($Waa['s']as$Wa_=>$Wap){unset($Waa['s'][$Wa_]);$Wba=Ws($Wn.$Wap)-Wj($Wn.$Wap);$Wv=$Wap;if($Wba<=$Wa)break;$Wv=false;if($Waa['v']>$Wba)$Waa['v']=$Wba;}$Wbb=time()-Wj($Wn.$Wv);if($Waa['v']>$Wbb)$Waa['v']=$Wbb;if(!$Wv){unlink(Wb.'u');if(Wg($Waz)){We();return;}Wh();}if(!$Waa['s']){unlink(Wb.'u');if(!$Waa['id']and file_exists(Wb.'t'))unlink(Wb.'t');if($Waa['w'])touch($Waa['w'],$Waa['v']);}else{file_put_contents(Wb.'u',serialize($Waa));if(!$Waa['id']){$Wbc=round(($Waa['r']-count($Waa['s']))/$Waa['r']*100);file_put_contents(Wb.'t',round(($Waa['r']-count($Waa['s']))/$Waa['r']*100));}}global$Ww,$Wbd;header("X-OpenCart-Lightning: Generated $Wv");$Ww=$Wn.$Wv;$Wbe=str_replace("//",'',$Wv);$Wt=strpos($Wbe,'/');$_SERVER["REQUEST_URI"]=substr($Wbe,$Wt);$Wap=str_replace('?','&',str_replace($Wbd,"",$Wv));$Wbf=explode('&',$Wap);$_GET=array();if(!$Wbf)$Wbf[0]='';if($Wbf[0]=="index.php")$Wbf[0]='';if($Wbf[0])$_GET["_route_"]=$Wbf[0];unset($Wbf[0]);foreach($Wbf as$Wbg){if(!$Wbg)continue;$Wbg=explode('=',$Wbg);$_GET[$Wbg[0]]=$Wbg[1];}Wi();}function Wt($W_){global$Wy,$Waa,$Wq,$Wn,$Wa,$Wb;$Wy=DIR_CACHE."lightning/alpha";$Waa['w']=$W_;$Waa['id']=$Wq;$Waa['v']=time();if(strpos($W_,"//")!==false){$Waa['w']=false;$Wbh=array($W_);}else$Wbh=unserialize(file_get_contents($W_));if(!$Wbh)$Wbh=array();$Wbi=array();$Wbj=time();foreach($Wbh as$Wbk=>$Wap){$Wba=Ws($Wn.$Wap);if($Wba<$Wb){$Wbi[]=$Wap;unset($Wbh[$Wbk]);continue;}if($Wap==$W_){Wu($Wn.$Wap);continue;}$Wba=$Wba-Wj($Wn.$Wap);if($Wba>$Wa)unset($Wbh[$Wbk]);if($Wba<$Wbj)$Wbj=$Wba;}$Wbh=array_merge($Wbi,$Wbh);if(!$Wbh){if(file_exists(Wb.'u'))unlink(Wb.'u');if($Waa['w'])touch($W_,$Wbj);return false;}$Waa['s']=$Wbh;$Waa['r']=count($Wbh);file_put_contents(Wb.'u',serialize($Waa));return true;}function Wg($Waz=false){global$Wn,$Wbd,$Wv,$Wa,$Wb;if(!$Waz)$Waz=$Wv;if(!$Waz)$Waz=$Wbd;if(file_exists(Wb.'u')&&filemtime(Wb.'u')>(time()-180)){$Waa=unserialize(file_get_contents(Wb.'u'));if(!$Waa['id']and$Waa['s'])return false;}$Wz=md5($Wn.$Wbd);$Wbl=DIR_CACHE."lightning/gamma"."/".substr($Wz,0,2)."/c".substr($Wz,2);if(!file_exists($Wbl)and Wt($Wbd))return true;$Wz=md5($Wn.$Waz);$Wbm=DIR_CACHE."lightning/gamma"."/".substr($Wz,0,2)."/c".substr($Wz,2);if(!file_exists($Wbm)and Wt($Waz))return true;if(file_exists($Wbl)&&filemtime($Wbl)<=$Wb&&Wt($Wbl))return true;if(file_exists($Wbm)&&filemtime($Wbm)<=$Wb&&Wt($Wbm))return true;if(file_exists($Wbl)&&filemtime($Wbl)<=$Wa&&Wt($Wbl))return true;if(file_exists($Wbm)&&filemtime($Wbm)<=$Wa&&Wt($Wbm))return true;return false;}function Wv($Wbn,$Wap){static$Wbo;if(!$Wbo){if(Ww())$Wbo=1;else$Wbo=-1;}if($Wbo>0)return;if(Ww($Wbn))return;global$Wbp;$Wap=str_replace("page={page}","",$Wap);$Wap=preg_replace("/page=[0-9]+/","",$Wap);$Wap=preg_replace("/page-[0-9]+/","",$Wap);$Wbp[]=$Wap;}function Wi(){global$light_ob;register_shutdown_function('Wac');ob_start();$light_ob=true;}function Wx($Wbn){$Wbq=Wy("","/",$Wbn);if($Wbq!=="module")return array();$Wak=Wy("/","",$Wbn);global$request,$config;if(isset($request->get['route'])){$Wbn=(string)$request->get['route'];}else{$Wbn='common/home';}$Wbr=0;Wz('load')->model('design/layout');if($Wbn=='product/category'&&isset($request->get['path'])){$Wbs=explode('_',(string)$request->get['path']);Wz('load')->model('catalog/category');$Wbr=Wz('model_catalog_category')->getCategoryLayoutId(end($Wbs));}if($Wbn=='product/product'&&isset($request->get['product_id'])){Wz('load')->model('catalog/product');$Wbr=Wz('model_catalog_product')->getProductLayoutId($request->get['product_id']);}if($Wbn=='information/information'&&isset($request->get['information_id'])){Wz('load')->model('catalog/information');$Wbr=Wz('model_catalog_information')->getInformationLayoutId($request->get['information_id']);}if(!$Wbr){$Wbr=Wz('model_design_layout')->getLayout($Wbn);}if(!$Wbr){$Wbr=$config->get('config_layout_id');}if(VERSION>="2.0"){global$db;$Wbt=$db->query("SELECT * FROM ".DB_PREFIX."layout_module WHERE layout_id = '".(int)$Wbr."'")->rows;Wz('load')->model('extension/module');foreach($Wbt as$Wbu){$Wbv=explode('.',$Wbu['code']);if($Wbv[0]!=$Wak)continue;if(isset($Wbv[0])&&$config->get($Wbv[0].'_status')){return array();}if(isset($Wbv[1])){$Wbw=Wz('model_extension_module')->getModule($Wbv[1]);if($Wbw&&$Wbw['status']){return$Wbw;}}}return array();}$Wbt=$config->get($Wak.'_module');if(!$Wbt)return array();foreach($Wbt as$Wbu)if($Wbu['layout_id']==$Wbr&&$Wbu['status'])return$Wbu;return array();}function W_(){global$Wp,$light_ob,$Wr,$config;if($light_ob)$config->set('bn',0);if($Wp=="gens"&&$Wr){global$Wd,$registry,$Wr;$Wbx=explode("~",$Wr);foreach($Wbx as$Wbk=>$Wby){$Wt=strpos($Wby,'_');$Wbx[$Wbk]=substr($Wby,0,$Wt)."/".substr($Wby,$Wt+1);}global$request;if(!empty($request->get["route"]))$Wbn=$request->get["route"];else$Wbn="common/home";if(VERSION>"2.0"){foreach($Wbx as$Wby)$Wd["md"]["#".str_replace("/","_",$Wby)]=Wz("load")->controller($Wby,Wx($Wby));}else{Wz("load")->model("setting/extension");class ControllerFake extends Controller{}$Wbz=new ControllerFake($registry);foreach($Wbx as$Wby){$Wd["md"]["#".str_replace("/","_",$Wby)]=$Wbz->getChildHtml($Wby,Wx($Wby));}}$We=json_encode($Wd);Wab($We);echo($We);exit;}}function Wk(&$We){if(!$We||(ord($We[0])!=31))return;if(function_exists("gzdecode"))$We=gzdecode($We);else$We=gzinflate(substr($We,10,-8));}function Wac(){global$light_ob,$Wv,$Wb_,$Wca,$Wcb;if(!$light_ob)return;$Wcc='';Wbs();while($Wt=ob_get_level()){$Wcc=ob_get_contents().$Wcc;ob_end_clean();if(ob_get_level()==$Wt)break;}if(!trim($Wcc))exit;if(Ww()or$Wcb){global$Waa;if($Waa)Wh(!empty($Waa['s']));Wao();if(headers_sent())Wk($Wcc);Wo($Wcc);exit;}Wk($Wcc);$Wap=$Wv;if(strpos($Wap,'?')or strpos($Wap,'&'))$Wap.='&';else$Wap.='?';$Wap.="li_op=gen";global$Wcd,$light_pregenerate;if($Wcd){$Wcd=str_replace("/","_",implode("~",$Wcd));}$Wce="<script type='text/javascript'>var li_cd=Math.floor(Math.random()*1000000);$(document).ready(function(){ $.get('".$Wap."s&md=".$Wcd."&cd='+li_cd,false,function(data){ $.each(data['md'],function(m,html){ $(m).replaceWith(html);});if(data['gen'])li_gen();},'json');});";$Wce.="function li_gen(){ $.get('".$Wap."&cd='+li_cd+'&rd='+Date.now(),false,function(data){if(data.trim()=='OK')li_gen();});}";$Wce.="</script>";$Wt=strpos($Wcc,"</body>");if($Wt){if(strpos($Wcc,"jquery",$Wt))$Wt=strpos($Wcc,"</html>");if($Wt)$Wcc=substr($Wcc,0,$Wt).$Wce.substr($Wcc,$Wt);}$Wcf=Wad($Wcc);global$Waa;if($Waa)Wh(!empty($Waa['s']));if(!$Wcf){Wab($Wcc,2);Wo($Wcc);}else Wo($Wcf);exit;}function Ww($Wbn=false){if(!$Wbn){global$request;if(!empty($request->get["route"]))$Wbn=$request->get["route"];else$Wbn="common/home";}global$light_cache_critical_only,$Wk;if($light_cache_critical_only and!$Wk){return!Wae("critical",$Wbn);}$Wcg=Wae("ignore",$Wbn);if($Wcg and Wae("not_ignore",$Wbn))$Wcg=false;if($Wcg)return true;if($Wk){global$Wu,$Wy;$Wch=$Wy;$Wy=DIR_CACHE."lightning/alpha";if(empty($_SERVER["HTTP_REFERER"]))return true;$Wap=Wd($_SERVER["HTTP_REFERER"]);$Wba=Ws($Wu.$Wap);$Wy=$Wch;if(!$Wba)return true;}return false;}function Wae($Wci,$Wap){$Wcj=$GLOBALS["light_".$Wci."_list"];if(!$Wcj)return false;$Wcj=explode(" ",$Wcj);$Wck=false;foreach($Wcj as$Wbn)if(strpos($Wap,$Wbn)!==false){$Wck=true;break;}return$Wck;}function Wm($Wcl,$Wcm,&$Wcn){if(!$Wcl)return;$Wco=explode("%*%",$Wcl['y']);$Wcp=0;foreach($Wco as$Wcq){$Wcp=strpos($Wcn,$Wcq,$Wcp);if($Wcp===false)return;$Wcp+=strlen($Wcq);}$Wt=$Wcp;$Wcr=explode("%*%",$Wcl['z']);foreach($Wcr as$Wcq){$Wcs=strpos($Wcn,$Wcq,$Wt);if($Wcs===false)return;$Wt=$Wcs+strlen($Wcq);}$Wcn=substr($Wcn,0,$Wcp).$Wcm.substr($Wcn,$Wcs);}function Wl($Wct,$Wcm,$Wcu,$Wav,&$Wcn){$Wcp=0;while(($Wcp=stripos($Wcn,$Wcu,$Wcp))!==false){$Wcp+=strlen($Wcu);if($Wav)$Wcs=stripos($Wcn,$Wav,$Wcp);else$Wcs=strlen($Wcn);if($Wcs){$Wcv=substr($Wcn,0,$Wcp);$Wcw=substr($Wcn,$Wcs);$Wcx=substr($Wcn,$Wcp,$Wcs-$Wcp);$Wcy=strlen($Wcx);if($Wct!=='')$Wcx=str_ireplace($Wct,$Wcm,$Wcx);else$Wcx=$Wcm;$Wcn=$Wcv.$Wcx.$Wcw;$Wcs=$Wcs+strlen($Wcx)-$Wcy;$Wcp=$Wcs+strlen($Wav);if($Wcp>strlen($Wcn))break;}}}function Wad($Wcz){global$Ww,$Wl,$Wf,$Wo,$Wk,$light_convert_currencies;if(!$Ww)return false;if(!$Wk){if(!empty($_SESSION["cart"])){Wa($Wl);Wm($Wf['j'],$Wf['_'],$Wcz);}if(!empty($_SESSION["wishlist"])and$Wf['k']){Wa($Wl);Wm($Wf['k'],"0",$Wcz);}if(!empty($_SESSION["compare"])and$Wf['l']){Wa($Wl);Wm($Wf['l'],"0",$Wcz);}if(!empty($_SESSION["customer_id"])){Wa($Wl);if(!$Wf['p'])return false;Wm($Wf['p'],$Wf['aa'],$Wcz);}$Wc_=Wz("currency")->getCode();if($Wc_!=$Wo['f']&&$light_convert_currencies){Wa($Wl);$Waj=$Wf['g'][$Wo['f']];Wl('',"//$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]",'name="redirect" value="','"',$Waj);Wm($Wf['h'],$Waj,$Wcz);Wn($Wc_,$Wo['f'],$Wcz);}}$Wda=gzencode($Wcz,9);global$Wy,$Wdb,$light_max_pagetime;$Wdb=$light_max_pagetime*60;if($Wk)$Wy=DIR_CACHE."lightning/tetha";else$Wy=DIR_CACHE."lightning/alpha";Waf($Ww,$Wda,true);global$light_track_last_modified;if($light_track_last_modified){$Wy=DIR_CACHE."lightning/delta";$Wdb=$light_max_pagetime*60*7;$Wdc=crc32($Wcz);$Waf=Wah($Ww);if($Waf)$Waf=unserialize($Waf);if(empty($Waf["cs"])||$Waf["cs"]!=$Wdc){$Waf["key"]=$Ww;$Waf["cs"]=$Wdc;$Waf["md"]=time();$Wdd=preg_replace(array("/<script\\b[^>]*>(.*?)<\\/script>/is","/\\d\\w*/","/\\s+/s"),array("",""," "),$Wcz);$Wde=crc32($Wdd);if(empty($Waf["scs"])||$Waf["scs"]!=$Wde){$Waf["scs"]=$Wde;$Waf["smd"]=time();}Waf($Ww,serialize($Waf));}}$Wdb=$light_max_pagetime*60;global$light_pregenerate,$Wbp,$Wv,$Wbd;if($light_pregenerate and!$Wk and$Wbp){global$Wn,$request;$Wbh=Wag("href='","'",str_replace('"',"'",$Wcz));$Wbh=array_unique($Wbh);foreach($Wbh as$Wbk=>$Wap){$Wap=preg_replace("/page=[0-9]+/","",$Wap);$Wap=preg_replace("/page-[0-9]+/","",$Wap);if(!strpos($Wap,"://")){$Wt=array_search($Wap,$Wbp);if(substr($Wap,0,1)=="/")$Wap=substr($Wap,1);$Wap=$Wbd.$Wap;$Wbh[$Wbk]=$Wap;if($Wt)$Wbp[$Wt]=$Wap;}if(!in_array($Wap,$Wbp))unset($Wbh[$Wbk]);else$Wbh[$Wbk]=Wd($Wbh[$Wbk]);}$Wy=DIR_CACHE."lightning/gamma";if(!empty($request->get["route"]))$Wbn=$request->get["route"];else$Wbn="common/home";if($Wbn!="common/home"){$Wdf=Wah($Wn.$Wbd);if($Wdf)$Wbh=array_diff($Wbh,unserialize($Wdf));}global$Wb;if(!in_array($Wv,$Wbh))$Wbh=array_merge(array($Wv),$Wbh);Waf($Ww,serialize(array_values($Wbh)),true);Wai($Ww,$Wb);global$Waa,$Waz;if($Waa and!$Waa['s']){Wg($Waz);}}if($Wf)return false;else return$Wda;}function Waj(){global$Wo,$Wbd;$Wo=unserialize(file_get_contents(Wb));$Wo['af']=0;if($Wo['ab']){if(isset($_SERVER["HTTPS"])&&(($_SERVER["HTTPS"]=="on")||($_SERVER["HTTPS"]=="1")))$Wap="https://";else$Wap="http://";$Wap.=str_replace('www.','',$_SERVER['HTTP_HOST']).rtrim(dirname($_SERVER['PHP_SELF']),'/.\\').'/';foreach($Wo['ab']as$Wdg=>$Wdh)if(str_replace("/www.","/",$Wdh['ac'])==$Wap ||str_replace("/www.","/",$Wdh['ad'])==$Wap){if(str_replace("/www.","/",$Wdh['ad'])==$Wap)$Wbd=$Wdh['ad'];else$Wbd=$Wdh['ac'];$Wo['ae']=$Wdh['ae'];$Wo['f']=$Wdh['f'];$Wo['b']=$Wdh['b'];$Wo['af']=$Wdg;break;}}}function Wa($Wdi=''){global$Wo,$Wf,$Wbd;if($Wdi and$Wf)return true;global$Wc;$Wdj=@disk_free_space(DIR_CACHE);if($Wdj&&$Wdj<$Wc){Wak("Not enough free disk space");return false;}if(!$Wbd)if(isset($_SERVER["HTTPS"])&&(($_SERVER["HTTPS"]=="on")||($_SERVER["HTTPS"]=="1")))$Wbd=HTTPS_SERVER;else$Wbd=HTTP_SERVER;if($Wdi and$Wo['af'])$Wdi.=$Wo['af'];if(file_exists(Wb.$Wdi)){if($Wdi){$Wf=unserialize(file_get_contents(Wb.$Wdi));return true;}else{Waj();if(!$Wo['af']&&filemtime(Wb)<time()-60*60*12){unlink(Wb);}else return true;}}if(file_exists(Wb.$Wdi))unlink(Wb.$Wdi);if(strpos(HTTP_SERVER,"/localhost/"))$Wdk="http://localhost/high2/service/";else$Wdk="http://lightning.devs.mx/service/";global$Wbd;$Wdl=$Wdk."saas.php?".'ag'."=".str_replace("://","x!x",$Wbd)."&".'ah'."=".$Wdi;$Way=false;if(!$Wdi){global$light_hard_optimization,$db;$Wan=false;if(!$db){$db=Wcs();$Wan=true;}$Wdm=$db->query("SELECT * FROM ".DB_PREFIX."setting LIMIT 1")->row;$Wdn=false;if(isset($Wdm['bb']))$Wdn='bb';elseif(isset($Wdm['bm']))$Wdn='bm';$Wdo="SELECT * FROM ".DB_PREFIX."setting";if($Wdn)$Wdo.=" WHERE `$Wdn`='config'";$Way['ai']=serialize($db->query($Wdo)->rows);$Way['aj']=serialize($db->query("SELECT * FROM `".DB_PREFIX."language`")->rows);$Way['ak']=serialize($db->query("SELECT * FROM ".DB_PREFIX."currency")->rows);$Way['al']=DB_PREFIX;$Way['x']=$light_hard_optimization;$Way['ao']=2;if($Wan)$db=false;}$Wdp=Wal($Wdl,$Way);if(substr($Wdp,0,1)=="!"){Wak(substr($Wdp,2));return false;}if(!$Wdi&&$Wdp!=='OK'){Wak("Lightning server communication error");return false;}global$Wdq;if(file_exists($Wdq)){unlink($Wdq);}if(!$Wdi){Waj();return true;}$Wf=unserialize($Wdp);file_put_contents(Wb.$Wdi,$Wdp);return true;}function Wb(){global$Wo,$Wg;if(!$Wo){if($Wg and isset($_SESSION['language'])and is_string($_SESSION['language']))return$_SESSION['language'];if(isset($_COOKIE['language']))return$_COOKIE['language'];return"en";}$languages=$Wo['am'];$Wdr='';if(isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])&&$_SERVER['HTTP_ACCEPT_LANGUAGE']){$Wds=explode(',',$_SERVER['HTTP_ACCEPT_LANGUAGE']);foreach($Wds as$Wdt){foreach($languages as$Wdu=>$Wdv){if($Wdv['status']){$Wdw=explode(',',$Wdv['locale']);if(in_array($Wdt,$Wdw)){$Wdr=$Wdu;}}}}}if($Wg and isset($_SESSION['language'])and!is_string($_SESSION['language']))unset($_SESSION['language']);if($Wg&&isset($_SESSION['language'])&&array_key_exists($_SESSION['language'],$languages)&&$languages[$_SESSION['language']]['status']){$Wdx=$_SESSION['language'];}elseif(isset($_COOKIE['language'])&&array_key_exists($_COOKIE['language'],$languages)&&$languages[$_COOKIE['language']]['status']){$Wdx=$_COOKIE['language'];}elseif($Wdr){$Wdx=$Wdr;}else{$Wdx=$Wo['ae'];}if(!isset($_SESSION['language'])||$_SESSION['language']!=$Wdx){$_SESSION['language']=$Wdx;}if(!isset($_COOKIE['language'])||$_COOKIE['language']!=$Wdx){setcookie('language',$Wdx,time()+60*60*24*30,'/',$_SERVER['HTTP_HOST']);$_COOKIE['language']=$Wdx;}return Wam($Wdx);}function Wan(){if(!isset($_SERVER['HTTP_USER_AGENT']))return false;$Wdy=$_SERVER['HTTP_USER_AGENT'];$Wdz="desktop";if((preg_match('/GoogleTV|SmartTV|Internet.TV|NetCast|NETTV|AppleTV|boxee|Kylo|Roku|DLNADOC|CE\-HTML/i',$Wdy))){$Wdz="tv";}elseif((preg_match('/Xbox|PLAYSTATION.3|Wii/i',$Wdy))){$Wdz="tv";}elseif((preg_match('/iP(a|ro)d/i',$Wdy))||(preg_match('/tablet/i',$Wdy))&&(!preg_match('/RX-34/i',$Wdy))||(preg_match('/FOLIO/i',$Wdy))){$Wdz="tablet";}elseif((preg_match('/Linux/i',$Wdy))&&(preg_match('/Android/i',$Wdy))&&(!preg_match('/Fennec|mobi|HTC.Magic|HTCX06HT|Nexus.One|SC-02B|fone.945/i',$Wdy))){$Wdz="tablet";}elseif((preg_match('/Kindle/i',$Wdy))||(preg_match('/Mac.OS/i',$Wdy))&&(preg_match('/Silk/i',$Wdy))){$Wdz="tablet";}elseif((preg_match('/GT-P10|SC-01C|SHW-M180S|SGH-T849|SCH-I800|SHW-M180L|SPH-P100|SGH-I987|zt180|HTC(.Flyer|\_Flyer)|Sprint.ATP51|ViewPad7|pandigital(sprnova|nova)|Ideos.S7|Dell.Streak.7|Advent.Vega|A101IT|A70BHT|MID7015|Next2|nook/i',$Wdy))||(preg_match('/MB511/i',$Wdy))&&(preg_match('/RUTEM/i',$Wdy))){$Wdz="tablet";}elseif((preg_match('/BOLT|Fennec|Iris|Maemo|Minimo|Mobi|mowser|NetFront|Novarra|Prism|RX-34|Skyfire|Tear|XV6875|XV6975|Google.Wireless.Transcoder/i',$Wdy))){$Wdz="mobile";}elseif((preg_match('/Opera/i',$Wdy))&&(preg_match('/Windows.NT.5/i',$Wdy))&&(preg_match('/HTC|Xda|Mini|Vario|SAMSUNG\-GT\-i8000|SAMSUNG\-SGH\-i9/i',$Wdy))){$Wdz="mobile";}elseif((preg_match('/Windows.(NT|XP|ME|9)/',$Wdy))&&(!preg_match('/Phone/i',$Wdy))||(preg_match('/Win(9|.9|NT)/i',$Wdy))){$Wdz="desktop";}elseif((preg_match('/Macintosh|PowerPC/i',$Wdy))&&(!preg_match('/Silk/i',$Wdy))){$Wdz="desktop";}elseif((preg_match('/Linux/i',$Wdy))&&(preg_match('/X11/i',$Wdy))){$Wdz="desktop";}elseif((preg_match('/Solaris|SunOS|BSD/i',$Wdy))){$Wdz="desktop";}elseif((preg_match('/Bot|Crawler|Spider|Yahoo|ia_archiver|Covario-IDS|findlinks|DataparkSearch|larbin|Mediapartners-Google|NG-Search|Snappy|Teoma|Jeeves|TinEye/i',$Wdy))&&(!preg_match('/Mobile/i',$Wdy))){$Wdz="desktop";}else{$Wdz="mobile";}if($Wdz=="tv")$Wdz="tablet";if($Wdz=="desktop")$Wdz=false;return$Wdz;}function Wam($Wdi){global$light_distinct_gadgets,$light_treat_tablets_as;$Wdz='';if(file_exists(DIR_SYSTEM."library/categorizr.php")){require_once(DIR_SYSTEM."library/categorizr.php");if(isMobile())$Wdz="mobile";elseif(isTablet())$Wdz="tablet";}elseif($light_distinct_gadgets)$Wdz=Wan();if($Wdz=="tablet")$Wdz=$light_treat_tablets_as;if($Wdz)$Wdi.="_".$Wdz;return$Wdi;}function Wc(){global$Wo,$Wg;$Wd_=$Wo['an'];if(isset($_GET["currency"])&&(array_key_exists($_GET["currency"],$Wd_))){$Wc_=$_GET["currency"];}elseif($Wg&&(isset($_SESSION["currency"]))&&(array_key_exists($_SESSION["currency"],$Wd_))){$Wc_=$_SESSION["currency"];}elseif((isset($_COOKIE["currency"]))&&(array_key_exists($_COOKIE["currency"],$Wd_))){$Wc_=$_COOKIE["currency"];if(!empty($_SESSION["currency"]))$_SESSION["currency"]=$Wc_;}else{$Wc_=$Wo['f'];if(!empty($_SESSION["currency"]))$_SESSION["currency"]=$Wc_;}return$Wc_;}function Wab(&$We,$Wea=2){if(headers_sent())return;if(!empty($_SERVER["HTTP_ACCEPT"])){if(substr($_SERVER["HTTP_ACCEPT"],0,5)=="image")return;}if(!isset($_SERVER["HTTP_ACCEPT_ENCODING"])||(strpos($_SERVER["HTTP_ACCEPT_ENCODING"],"gzip")!==false)){$Web="gzip";}if(isset($_SERVER["HTTP_ACCEPT_ENCODING"])&&(strpos($_SERVER["HTTP_ACCEPT_ENCODING"],"x-gzip")!==false)){$Web="x-gzip";}$Wec=false;if(!empty($_SERVER["HTTP_USER_AGENT"]))$Wec=$_SERVER["HTTP_USER_AGENT"];if(strpos($Wec,"MSIE 7")||strpos($Wec,"MSIE 8"))$Web=false;if(empty($Web)){Wk($We);return;}if(!extension_loaded("zlib")||ini_get("zlib.output_compression")){Wk($We);return;}if(headers_sent()){Wk($We);return;}if(connection_status()){Wk($We);return;}header("Content-Encoding: ".$Web);if(ord($We[0])!=31)$We=gzencode($We,$Wea);return true;}function Wao(){global$Wed,$Wab,$Wee,$Wef;$Weg=0;if($Wab){$Weh="Served in ".Waq(microtime(true)-$Wed)." sec from page cache written ".War(microtime(true)-$Wab)." ago. ";}else{$Weg=microtime(true)-$Wed;$Weh="Generated in ".Waq($Weg)." sec. ";}$Wei=false;if($Wef){$Weh.=$Wef." cached queries, ";$Wei="real ";}if($Wee==1)$Weh.="1 ".$Wei."DB query used.";elseif($Wee)$Weh.=$Wee." ".$Wei."DB queries used.";else{if($Wei)$Weh.="no ";else$Weh.="No ";$Weh.=$Wei."DB connection used.";}global$Wej,$Wek;if($Weg){$Wel=$Weg-$Wej;$Wem=$Wej-$Wek;$Wen=round($Wel/$Weg*100);$Weo=round($Wem/$Weg*100);$Wep=round($Wek/$Weg*100);$Wax=array();if($Wen)$Wax[]=$Wen."% PHP";if($Weo)$Wax[]=$Weo."% Beta";if($Wep)$Wax[]=$Wep."% SQL";$Weh.=" [".implode(", ",$Wax)."]";}if(!headers_sent())header("X-OpenCart-Lightning: ".$Weh);}function Wo($We,$Weq=false){if($We){Wab($We);}Wao();if(!headers_sent()){header("Content-Length: ".strlen($We));if($Weq)header("Connection: Close");}echo$We;if($Weq){if(@ob_get_level())@ob_flush();@flush();if(function_exists("fastcgi_finish_request"))@fastcgi_finish_request();}Wap();}function Waq($Wer){if($Wer<1)$Wer=round($Wer,3);elseif($Wer<2)$Wer=round($Wer,2);elseif($Wer<6)$Wer=round($Wer,1);else$Wer=round($Wer);return($Wer);}function War($Wba){if($Wba<60)return Waq($Wba)." sec";$Wba=round($Wba/60);if($Wba<60)return$Wba." min";$Wba=round($Wba/60);if($Wba==1)return"1 hour";if($Wba<60)return$Wba." hours";$Wba=round($Wba/24);if($Wba==1)return"1 day";return$Wba." days";}function Wj($Wdu){global$light_pagetime;$Wes=crc32($Wdu)%($light_pagetime*20);return$Wes;}function Wal($Wap,$Wet){$Weu=curl_init($Wap);curl_setopt($Weu,CURLOPT_URL,$Wap);curl_setopt($Weu,CURLOPT_RETURNTRANSFER,1);curl_setopt($Weu,CURLOPT_ENCODING,"");curl_setopt($Weu,CURLOPT_TIMEOUT,200);curl_setopt($Weu,CURLOPT_CONNECTTIMEOUT,200);if($Wet){curl_setopt($Weu,CURLOPT_POST,1);curl_setopt($Weu,CURLOPT_POSTFIELDS,$Wet);}$Wev=curl_exec($Weu);global$Wew;$Wew=curl_getinfo($Weu,CURLINFO_HTTP_CODE);return$Wev;}function Was(){if(empty($_COOKIE['a']))return false;global$session;if(session_id())session_write_close();$Wex=array_fill(0,1012,0);$session->data["wishlist"]=$Wex;$Wex[]=0;$session->data["compare"]=$Wex;if($_COOKIE['a']!=2)return false;$Wey["customer_id"]=4567;$Wey["firstname"]="Mirabelya";$Wey["lastname"]="Lightmeni";$Wey["email"]="mirabelya@lightmen.com";return$Wey;}function Wat($Wez,&$Wcc){$Wbn=Wy("template/",".tpl",$Wez);$Wbn=str_replace("_mobile","",$Wbn);$Wbn=str_replace("_tablet","",$Wbn);global$Wp,$Wr;if(!($Wp=="gens"and$Wr)&&Wae("ajax_update",$Wbn)&&!Ww()){global$Wcd;$Wcd[]=$Wbn;$Wcc="<div id='".str_replace("/","_",$Wbn)."'></div>";return false;}if(empty($_COOKIE['a']))return false;if($Wbn=="common/cart"||$Wbn=="module/cart"){$Wcc='<Wao>'.$Wcc.'<Wap>';if($_COOKIE['a']==1){$We_[]=Wz("language")->get("decimal_point");$We_[]=Wz("language")->get("thousand_point");$Wcc.='<Was>'.base64_encode(serialize($We_)).'<Wat>';}}elseif($Wbn=="module/currency"||$Wbn=="common/currency"){if($_COOKIE['a']==1){$Wcc='<Waq>'.$Wcc.'<War>';$We_[]=Wz("language")->get("decimal_point");$We_[]=Wz("language")->get("thousand_point");$Wcc.='<Was>'.base64_encode(serialize($We_)).'<Wat>';return false;}static$Wd_,$Wfa,$Wfb;if($Wfb)return false;global$db;if(!$Wfa)$Wfa=Wz("currency")->getCode();$Wcc=$Wcc.'<Wau'.Wz("currency")->getCode().'>';if(!strpos($Wcc,'<War>')){$Wcc='<Waq>'.$Wcc.'<War>';$Wdo=$db->query("SELECT * FROM ".DB_PREFIX."currency WHERE status=1");foreach($Wdo->rows as$Wev)$Wd_[]=$Wev["code"];}if($Wd_){if(VERSION>="2.0"){foreach($Wd_ as$Wfc){$Wfb=true;Wz("currency")->set($Wfc);$Wcc.=Wz("load")->controller("common/currency").'<Wau'.Wz("currency")->getCode().'>';$Wfb=false;}}else{$Wdu=array_keys($Wd_);$Wdu=reset($Wdu);Wz("currency")->set($Wd_[$Wdu]);unset($Wd_[$Wdu]);return$Wbn;}}if($Wfa)Wz("currency")->set($Wfa);}return false;}function Wak($Weh){global$Wdq,$Wl,$Wo;file_put_contents($Wdq,$Weh);if(file_exists(Wb))unlink(Wb);if(file_exists(Wb.$Wl))unlink(Wb.$Wl);$Wo=false;}function Wau($Wfd){global$Wfe,$Wff;static$Wfg,$Wfh,$Wfi,$Wfj,$Wfk,$Wfl;if($Wfg!=$Wff){global$Wo,$Wf;$Wfg=$Wff;$Wfh=(int)$Wo['an'][$Wff]['av'];if(!$Wfh&&$Wfh!=="0")$Wfh=2;$Wfi=$Wo['an'][$Wff]['aw'];$Wfj=$Wo['an'][$Wff]['ax'];$Wfk=$Wf['ay'];$Wfl=$Wf['az'];}$Wdv=Wav($Wfd[1])*$Wfe;$Wfm=$Wfi.number_format(round($Wdv,$Wfh),$Wfh,$Wfk,$Wfl).$Wfj;return$Wfm;}function Wn($Wfn,$Wfg,&$We){global$Wo,$Wf,$Wfe,$Wff;if(isset($Wo['an'][$Wfn])){$Wfo=$Wo['an'][$Wfn]['a_'];}else{return;}if(isset($Wo['an'][$Wfg])){$Wfp=$Wo['an'][$Wfg]['a_'];}else{return;}$Wfe=$Wfp/$Wfo;$Wff=$Wfg;$We=preg_replace_callback("/".preg_quote($Wo['an'][$Wfn]['aw'])."([0-9][0-9".preg_quote($Wf['az']).preg_quote($Wf['ay'])."]*)".preg_quote($Wo['an'][$Wfn]['ax'])."/u",'Wau',$We);}function Waw($Wfq=false,$Wcc=false){if(!$Wfq)unset($_SESSION['i']);else$_SESSION['i']=$Wcc;}function Wax($Wfr){$_SESSION['m']=$Wfr["firstname"];}function Wav($Wfs){$Wer=preg_replace("/[^0-9.,]/i",'',$Wfs);if(substr($Wer,-3,1)==","){$Wer=substr($Wer,0,-3).".".substr($Wer,-2);$Wer=str_replace(",","",$Wer);}$Wer=str_replace(",","",$Wer);$Wft=round(abs($Wer),2);return$Wft;}function Wag($Wcu,$Wfu,$Wcn){preg_match_all("/$Wcu([^$Wfu]*)/i",$Wcn,$Wfd);return($Wfd[1]);}function Way(){global$Wp;if($Wp)return true;else return false;}function Wz($Wfv){global$registry;return$registry->get($Wfv);}